# 毛利表生成器

一个专业的Excel数据处理工具，用于自动生成和管理商品毛利表。

## 功能特性

- **数据导入**：支持Excel格式的原始商品数据导入
- **智能处理**：自动提取商品配置、尺寸、速别、颜色等信息
- **毛利表生成**：按配置分组生成标准化毛利表
- **价格更新**：支持导入修改后的毛利表，自动更新原始数据价格
- **多尺寸支持**：智能处理24寸、26寸、27.5寸等不同规格
- **详细日志**：完整的匹配过程日志，便于调试和验证

## 安装要求

```bash
pip install -r requirements.txt
```

## 使用方法

### 方式一：图形界面（推荐）

1. 双击运行 `启动毛利表生成器.bat`
2. 或者运行：`python main.py`

### 方式二：命令行

```bash
python generate_profit_table.py
```

## 操作流程

### 1. 生成毛利表
1. 点击"导入Excel数据"，选择原始数据文件
2. 系统自动处理数据并生成毛利表
3. 点击"导出毛利表"保存Excel文件

### 2. 更新价格
1. 修改导出的毛利表中的价格
2. 点击"导入更新后的毛利表"，选择修改后的文件
3. 点击"导出改价后原始数据"获取更新后的数据

## 数据格式要求

### 输入数据列
- **货品ID**：商品唯一标识
- **规格ID**：规格唯一标识  
- **分类**：商品分类
- **简称**：商品名称（包含尺寸、速别等信息）
- **价格**：销售价格
- **成本**：商品成本
- **毛利**：毛利金额（可选）
- **毛利率**：毛利率（可选）

### 输出毛利表列
- **配置**：商品配置名称
- **速别**：速别信息
- **价格**：销售价格
- **成本**：商品成本
- **快递**：快递费用（固定30元）
- **毛利润**：自动计算（价格-成本-快递）
- **毛利率**：自动计算（毛利润/价格×100%）
- **简称**：原始商品名称

## 价格匹配逻辑

1. **直接匹配**：优先使用原始简称直接匹配
2. **尺寸规范化**：匹配失败时，将24寸、27.5寸统一为26寸再匹配
3. **尺寸价格调整**：27.5寸商品在26寸价格基础上加20元

## 数据筛选规则

- 优先保留26寸规格数据
- 同配置多价格时选择最低价格
- 自动去重和数据清洗
- 按配置最高价格升序排列

## 文件结构

```
excelutil/
├── main.py                    # 主程序入口
├── data_processor.py          # 数据处理核心
├── excel_exporter.py          # Excel导出功能
├── generate_profit_table.py   # 命令行版本
├── gui/main_window.py         # 图形界面
├── utils/logger.py            # 日志工具
├── config/settings.py         # 配置文件
└── logs/                      # 日志目录
```

## 注意事项

- 确保Excel文件格式正确，包含必要的列
- 货品ID和规格ID会自动保持为文本格式，防止精度丢失
- 快递费固定为30元，可在代码中修改
- 支持中文文件名和路径
- 建议定期备份重要数据

## 技术支持

如遇问题请查看 `logs/app.log` 日志文件获取详细错误信息。